//package converter; // NetBeans IDE

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.*;

/**
 * txtMaker. Creates and edits a new txt file containing calculated data.
 * 
 * @author Emilio E, Phillip N, Kai W.
 * @version 20.October.2018
 */
public class txtMaker 
{
    double dist, totalAfterCollection, finalTotal;
    // weights (lbs)
    double waste = 0, stMary = 0, tefap = 0, grocery = 0, corp = 0, church = 0, individual = 0, start = 0;
    
    int totalDonees = 0, clients = 0;
    
    double totalCollected = 0;
    
    public txtMaker(ArrayList<Donor> donorList, ArrayList<Donee> doneeList, File prevMonth)
    {
        
        clients = doneeList.size();
        
        try
        {

            Scanner inputStream = new Scanner(prevMonth);
            String firstLine = inputStream.nextLine();
            firstLine = firstLine.replace("Starting Inventory:\t\t","");
            start = Double.parseDouble(firstLine);
            inputStream.close();

        } catch (FileNotFoundException ex)
        {

            //System.out.println("File does not exist.");
            Scanner scanner = new Scanner(System.in);
            boolean exit = false;
            
            do
            {
                
                System.out.print("Please input starting inventory (lbs): ");
                
                if(scanner.hasNextDouble()) {
                    
                   exit = true;
                    
                }
                else
                {
                    
                    System.out.println("Invalid Inventory(lbs)");
                    scanner.next();
                    
                }
                
            } while(!exit);
            
            start = scanner.nextDouble();
            scanner.close();
        
        }
        
        for(Donor donor : donorList)
        {
        
            if(donor.getLastName().toUpperCase().equals("WASTE"))
            {
                
                waste += donor.getWeight();
                totalCollected -= donor.getWeight();
                
            }
            else if(donor.getFirstName().toUpperCase().contains("ST. MARY"))
            {
                
                totalCollected += donor.getWeight();
                stMary += donor.getWeight();
            
            }
            else if(donor.getFirstName().toUpperCase().contains("TEFAP"))
            {
                
                totalCollected += donor.getWeight();
                tefap += donor.getWeight();
            
            }
            else if(donor.getFirstName().contains("#"))
            {
                totalCollected += donor.getWeight();
                grocery += donor.getWeight();
            }
            else if(donor.getDonationSource().toUpperCase().contains("BUSINESS"))
            {
                
                totalCollected += donor.getWeight();
                corp += donor.getWeight();
            
            }
            else if(donor.getDonationSource().toUpperCase().contains("CHURCH"))
            {
                
                totalCollected += donor.getWeight();
                church += donor.getWeight();
            
            }
            else if(donor.getDonationSource().toUpperCase().contains("INDIVIDUAL"))
            {
                
                totalCollected += donor.getWeight();
                individual += donor.getWeight();
                
            }
        
        }
        
        for(Donee donee : doneeList)
        {
                
            totalDonees += donee.getHouseHoldTotal();
                
        }
        
        dist = clients * 40;
        
        totalAfterCollection = start + totalCollected;
        
        finalTotal = totalAfterCollection - waste - dist;
        
    }
    public void saveTXT(String folderLocation, ArrayList<Donor> donorList)
    {
        
        try
        {
            
            String fileName = donorList.get(0).getMonthYear() + "_" + donorList.get(donorList.size() - 1).getMonthYear() + ".txt";
            File file = new File(folderLocation + File.separator +  fileName);
            FileWriter fw = new FileWriter(file);
            BufferedWriter bw = new BufferedWriter(fw);
            try (PrintWriter outFile = new PrintWriter(bw)) {
                outFile.println("Starting Inventory:\t\t" + start);
                outFile.println("Number of Clients:\t\t" + clients);
                outFile.println("Total Served:\t\t\t" + totalDonees);
                outFile.println("Distributed:\t\t\t" + dist);
                outFile.println();
                outFile.println("Inventory " + donorList.get(0).getDonatedOn() + "-" + donorList.get(donorList.size() - 1).getDonatedOn());
                outFile.println("----------------------------------------");
                outFile.println("Grocery Store:\t\t\t" + grocery);
                outFile.println("Individual:\t\t\t" + individual);
                outFile.println("Corperate/Organization:\t\t" + corp);
                outFile.println("Church:\t\t\t\t" + church);
                outFile.println("TEFAP:\t\t\t\t" + tefap);
                outFile.println("St. Mary's - senior food fox:\t" + stMary);
                outFile.println("Total:\t\t\t\t" + totalAfterCollection);
                outFile.println("Waste (minus):\t\t\t" + waste);
                outFile.println("Total:\t\t\t\t" + finalTotal);
                
                
            }
            
        }
        catch(IOException e)
        {
            System.out.print("IOException");
        }
    }
    
}
